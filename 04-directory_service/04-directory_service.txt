Lab 04 : directory service 
==========================
:author: Louis Coilliot
:numbered:
:icons:
:data-uri:
:iconsdir: /home/lofic/Documents/icons/asciidoc

Introduction
------------

We will install a LDAP directory service to provide a central source for account
information. 

The communication with the server will be encrypted using SSL/TLS.

The open source LDAP server used here is '389 Directory Server'.

This is a guided lab.

Prerequisites
-------------

On Centos 6 you will need to set some additional yum repositories :

* EPEL
* Continuous release (cr)
* 389-ds-base from Rich Megginson

--------------------------------------------------------------------------------
rpm -Uvh http://rpmfind.net/linux/epel/6/i386/epel-release-6-7.noarch.rpm
yum -y install centos-release-cr
wget http://repos.fedorapeople.org/repos/rmeggins/389-ds-base/epel-389-ds-base.repo \
 -O /etc/yum.repos.d/epel-389-ds-base.repo 
yum clean all && yum makecache
--------------------------------------------------------------------------------

Install 389-DS
--------------

--------------------------------------------------------------------------------
yum -y install 389-ds
--------------------------------------------------------------------------------

Set the Directory service
-------------------------

We will set a response file for a non interactive installation.

Get the template here :
link:https://raw.github.com/lofic/linuxlab/master/04-directory_service/resources/setup-ds-admin-full.inf[setup-ds-admin-full.inf]

Adjust the parameters to your need.

For example :

--------------------------------------------------------------------------------
wget https://raw.github.com/lofic/linuxlab/master/04-directory_service/resources/setup-ds-admin-full.inf 
CDADMINPW=plokiploki;SADMINPW=plokiploki;RDNPW=plokiploki
SRVHOSTNAME=el6a.labolinux.fr
SRVIP=192.168.0.60
sed -i "s/CDADMINPW/$CDADMINPW/g" setup-ds-admin-full.inf
sed -i "s/SADMINPW/$SADMINPW/g"   setup-ds-admin-full.inf
sed -i "s/RDNPW/$RDNPW/g"         setup-ds-admin-full.inf
sed -i "s/SRVIP/$SRVIP/g"         setup-ds-admin-full.inf
sed -i "s/SRVHOSTNAME/$SRVHOSTNAME/g" setup-ds-admin-full.inf
--------------------------------------------------------------------------------

Generate the password hash for HashedRootDNPwd with `htpsswd`

The default password in the template is `plokiploki`

Then :

--------------------------------------------------------------------------------
setup-ds-admin.pl -k -s -f setup-ds-admin-full.inf
--------------------------------------------------------------------------------

Enable and activate the services
--------------------------------

--------------------------------------------------------------------------------
/sbin/chkconfig dirsrv on
/sbin/chkconfig dirsrv-admin on

/sbin/service dirsrv status
/sbin/service dirsrv-admin status
--------------------------------------------------------------------------------

Test the service :

--------------------------------------------------------------------------------
ldapsearch -x -h localhost -p 389 -s base -b "" "objectclass=*"
--------------------------------------------------------------------------------

Setup the web applications :

--------------------------------------------------------------------------------
setup-ds-dsgw

/sbin/service dirsrv-admin restart
--------------------------------------------------------------------------------

